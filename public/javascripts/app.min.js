window.tfFrames={loadFrames:function(){for(var e=this.output,t=e.value,a=t.split("\n"),n=0,i=0;i<a.length;i++){var r=a[i].split("|");r.length>=5&&n++}var s=a[0].split("|")[1],l=a[0].split("|")[0];this.nameElement.value="_"==s[s.length-1]?s.substring(0,s.length-1):s,this.setAnimationName(),this.frameCount.value=n,this.frameClass.value=l,this.generateFrames();for(var i=0;i<a.length;i++){var r=a[i].split("|");if(r.length>=5){var u=this.getFrame(r[2],r[1]);u.dataset.frameExposureCount=r[3],u.setAttribute("style",r[4])}}},generateFrames:function(){var e=(this.body,this.output,this.framesDiv),t=this.frameCount.value,a=this.frameClass.value,n=this.frameName.value,i=this.selectFrame;i.dataset.frameName=n,this.frameName2.value=n;for(var r=0,s=e.childElementCount;t>r;){var l=document.createElement("span");l.dataset.frameCount=s+1,l.dataset.frameExposureCount=1,0==r?l.setAttribute("class","opaque frame "+n+(s+1)+" "+a):l.setAttribute("class","ghost frame "+n+(s+1)+" "+a),l.setAttribute("style",""),e.appendChild(l);var u=document.createElement("option");u.setAttribute("value",s+1),u.innerHTML=n+(s+1),i.appendChild(u),r++,s++}},getFrame:function(e,t){for(var a=void 0,n=document.querySelectorAll('[data-frame-count="'+e+'"]'),i=0;i<n.length;){var r=n[i].className.split(" ");if(n[i].dataset.frameCount==e&&r.indexOf(t+e)>=0){a=n[i];break}}return a},_keyFrames:function(e){for(var t=0,a=1,n=this.frameCount.value,i=this.frameName.value,r=this.frameClass.value,s=i,l=0,u="@keyframes "+s+"_"+l+" {\n",d=s+"_"+l+" 1s steps(1) 1 "+l+"s normal, ",o=0,m=1,c="/* Frame Data: \n";n>t;){var p=this.getFrame(a,i),h=4.16*p.dataset.frameExposureCount;if(o+h>100){for(var v=0,b=1;b<=p.dataset.frameExposureCount&&(v=4.16*b,!(o+v>100));b++);v--,h-=v;var f=o+4.16*v;f>98&&(f=100),u+="  "+o+"%,"+f+"% {",e&&(u+="    /* frame "+(t+1)+" rules here */");var A=this.getStyle(a,i);void 0!=A&&(u+=A,c+=r+"|"+i+"|"+a+"|"+A+"\n"),u+="}\n",d+=s+"_"+l+" 1s steps(1) 1 "+l+"s normal, ",l++,m=1,o=0,u+="}\n\n",u+="@keyframes "+s+"_"+l+" {\n"}var g=o+h;(g>98||t==n-1)&&(g=100),u+="  "+o+"%,"+g+"% {",e&&(u+="    /* frame "+(t+1)+" rules here */");var A=this.getStyle(a,i);void 0!=A&&(u+=A,c+=r+"|"+i+"|"+a+"|"+p.dataset.frameExposureCount+"|"+A+"\n"),u+="}\n",o=g,m++,a++,t++}return u+="}\n\n",{animations:d.substr(0,d.length-2),keyframes:u,frameData:c+"*/"}},generateKeyframes:function(){var e=this._keyFrames(!0),t=this.output,a=this.frameName.value;t.value="",t.value=t.value+"."+a+".animate {\n",t.value=t.value+"  animation: "+e.animations+";\n",t.value=t.value+"  animation-fill-mode: forwards;\n}\n\n",t.value=t.value+e.keyframes,t.value=t.value+e.frameData+"*/\n"},getStyle:function(e,t){var a=this.getFrame(e,t);return a.getAttribute("style")},changeSelectFrame:function(){var e=document.getElementsByClassName("opaque").length>0?document.getElementsByClassName("opaque")[0]:void 0;void 0!=e&&(e.className=e.className.replace(/(?:^|\s)opaque(?!\S)/g,"ghost"));var t=this.selectFrame,a=this.getFrame(t.value,t.dataset.frameName);a.className=a.className.replace(/(?:^|\s)ghost(?!\S)/g,"opaque");var n=a.getAttribute("style");return this.frameStyle.value=n,this.exposureCount.value=a.dataset.frameExposureCount,!0},setFrameStyle:function(){var e=this.selectFrame,t=this.getFrame(e.value,e.dataset.frameName),a=(t.getAttribute("style"),this.frameStyle);return t.setAttribute("style",a.value),!0},setFrameExposureCount:function(){var e=this.selectFrame,t=this.getFrame(e.value,e.dataset.frameName);return t.dataset.frameExposureCount=this.exposureCount.value,!0},toggle:function(){var e=this.toggleBtn,t=this.form,a=this.output,n=this.body,i=this.framesDiv;"display:none;"===t.getAttribute("style")?(this.clearTest(),t.setAttribute("style",""),a.setAttribute("style",""),i.setAttribute("style",""),n.className+="grid",e.innerHTML="Hide >",this.keepBtn.setAttribute("disabled","")):(t.setAttribute("style","display:none;"),a.setAttribute("style","display:none;"),i.setAttribute("style","display:none;"),n.className=n.className.replace(/(?:^|\s)grid(?!\S)/g,""),e.innerHTML="Show >")},clearTest:function(){var e=this.nameElement.value,t=document.getElementById(e+"Test");void 0!=t&&t.parentNode.removeChild(t);var a=document.getElementById(e+"StyleTest");void 0!=a&&a.parentNode.removeChild(a)},outputToHTML:function(){this.output.value="<!DOCTYPE html>\n",this.output.value+='<html lang="en">\n',this.output.value+="  <head>\n",this.output.value+='    <meta charset="utf-8" />\n',this.output.value+='    <meta http-equiv="x-ua-compatible" content="ie=edge, chrome=1">\n',this.output.value+="    <title>Animation</title>\n",this.output.value+='    <meta name="viewport" content="width=device-width, initial-scale=1">\n',this.output.value+='    <link rel="stylesheet" href="stylesheet.css">\n',this.output.value+='    <style type="text/css">\n';for(var e=document.getElementsByTagName("pre"),t=0;t<e.length;t++){var a=e[t];this.output.value+="      "+a.innerHTML}this.output.value+="\n   </style>\n",this.output.value+="  </head>\n",this.output.value+="  <body>\n";for(var n=document.getElementsByTagName("span"),t=0;t<n.length;t++){var i=n[t];i.className.indexOf("animate")>=0&&(this.output.value+="      <span class='"+i.className+"'></span>\n")}return this.output.value+="  </body>\n",this.output.value+="</html>\n",!0},clearForm:function(){for(this.nameElement.value="",this.selectFrame.innerHTML="",this.selectFrame.dataset.frameName="";this.framesDiv.children.length>0;){var e=this.framesDiv.children[0];void 0!=e&&e.parentNode.removeChild(e)}this.frameClass.value="",this.frameStyle.value="",this.frameName.value="",this.frameName2.value="",this.exposureCount.value="1",this.frameCount.value="50",this.output.value=""},reEdit:function(){var e=this.selectAni.value,t=document.getElementById(e+"FrameData");if(void 0!=t){for(var a=t.innerHTML.split("\n"),n=a[2]+"\n",i=3;"*/"!=a[i]&&i<a.length-1;)n+=a[i++]+"\n";console.log(n),this.output.value=n,this.loadFrames(),this.output.value="";var r=document.getElementById(e);void 0!=r&&r.parentNode.removeChild(r);var s=document.getElementById(e+"Style");void 0!=s&&s.parentNode.removeChild(s),t.parentNode.removeChild(t);for(var l=this.selectAni.children,u=void 0,i=0;i<l.length;i++)if(l[i].innerHTML==e){u=l[i];break}void 0!=u&&this.selectAni.removeChild(u)}},save:function(){this.testBtn.setAttribute("disabled",""),this.keepBtn.setAttribute("disabled",""),this.exportDataBtn.removeAttribute("disabled");var e=this._keyFrames(!0),t=this.nameElement.value,a=this.frameName.value,n=document.getElementById(t+"StyleTest");void 0!=n&&n.setAttribute("id",t+"Style");var i=document.getElementById(t+"Test");void 0!=i&&i.setAttribute("id",t);var r=document.createElement("option");r.setAttribute("value",t),r.appendChild(document.createTextNode(t)),this.selectAni.appendChild(r),reEditBtn.removeAttribute("disabled"),this.clearForm();var s=document.createElement("pre");s.setAttribute("id",t+"FrameData"),s.setAttribute("style","display:none;"),s.innerHTML="/*"+t+"*/\n"+e.frameData+"\n"+e.keyframes+"\n."+a+".animate {animation: "+e.animations+";animation-fill-mode: forwards;}",this.body.appendChild(s),this.toggleFrameDataBtn.removeAttribute("disabled")},test:function(){this.clearTest();var e=this.nameElement.value,t=this.frameName.value,a=this.frameClass.value,n=(this.getFrame(1,t),document.createElement("span"));n.setAttribute("id",e+"Test");var i=this.body;this.stageDiv.appendChild(n);var r=document.createElement("style");r.setAttribute("id",e+"StyleTest"),r.appendChild(document.createTextNode("")),i.appendChild(r);var s=this._keyFrames(!1);console.log(s.keyframes);for(var l=s.keyframes.split("\n\n"),u=0;u<l.length;u++)l[u].length>0&&r.sheet.insertRule(l[u],u);r.sheet.insertRule("."+t+".animate {animation: "+s.animations+";animation-fill-mode: forwards;}",1),console.log(r.sheet.cssRules),n.className=a+" "+t+" animate";var d=document.getElementsByTagName("form")[0];"display:none;"===d.getAttribute("style")||this.toggle(),this.keepBtn.removeAttribute("disabled");for(var o=document.getElementsByClassName("animate"),m=[],c=o.length,u=0;c>u;u++)m.push(o[u].getAttribute("id"));for(var u=0;u<m.length;u++){var p=document.getElementById(m[u]);void 0!=p&&(p.className=p.className.replace(/(?:^|\s)animate(?!\S)/g,""))}var h=setTimeout(function(){for(var e=0;e<m.length;e++){var t=document.getElementById(m[e]);void 0!=t&&(t.className=t.className+" animate")}clearTimeout(h)},10)},setAnimationName:function(){this.frameName.value=this.nameElement.value+"_",this.testBtn.removeAttribute("disabled")},toggleFrameData:function(){for(var e=document.getElementsByTagName("pre"),t="display:none;",a=0;a<e.length;a++){var n=e[a],i=n.getAttribute("style");i===t?(n.setAttribute("style",""),this.toggleFrameDataBtn.innerHTML="Hide Data"):(n.setAttribute("style",t),this.toggleFrameDataBtn.innerHTML="View Data")}},init:function(){var e=1,t=document.getElementsByTagName("body")[0];this.body=t;var a=document.createElement("button");a.setAttribute("type","button"),a.setAttribute("id","tbtn"),a.setAttribute("onclick","window.tfFrames.toggle();"),a.setAttribute("tabindex",e++),a.appendChild(document.createTextNode("Hide >")),this.toggleBtn=a,t.appendChild(a);var n=document.createElement("button");n.setAttribute("type","button"),n.setAttribute("id","tbtn"),n.setAttribute("onclick","window.tfFrames.test();"),n.setAttribute("disabled",""),n.setAttribute("tabindex",e++),n.appendChild(document.createTextNode("Test >")),this.testBtn=n,t.appendChild(n);var i=document.createElement("button");i.setAttribute("type","button"),i.setAttribute("id","keepBtn"),i.setAttribute("onclick","window.tfFrames.save();"),i.setAttribute("disabled",""),i.setAttribute("tabindex",e++),i.appendChild(document.createTextNode("Keep")),this.keepBtn=i,t.appendChild(i);var r=document.createElement("button");r.setAttribute("type","button"),r.setAttribute("id","toggleFrameDataBtn"),r.setAttribute("onclick","window.tfFrames.toggleFrameData();"),r.setAttribute("disabled",""),r.setAttribute("tabindex",e++),r.appendChild(document.createTextNode("View Data")),this.toggleFrameDataBtn=r,t.appendChild(r);var s=document.createElement("button");s.setAttribute("type","button"),s.setAttribute("id","exportBtn"),s.setAttribute("onclick","window.tfFrames.outputToHTML();"),s.setAttribute("disabled",""),s.setAttribute("tabindex",e++),s.appendChild(document.createTextNode("Get HTML")),this.exportDataBtn=s,t.appendChild(s);var l=document.createElement("form");this.form=l;var u=document.createElement("ol"),d=document.createElement("li");u.appendChild(d);var o=document.createElement("p"),m=document.createElement("label");m.innerHTML="Give a name (no spaces please)",o.appendChild(m);var c=document.createElement("input");c.setAttribute("type","text"),c.setAttribute("id","name"),c.setAttribute("tabindex",e++),c.setAttribute("onkeyup","window.tfFrames.setAnimationName();"),this.nameElement=c,o.appendChild(c),d.appendChild(o);var p=document.createElement("li");u.appendChild(p);var h=document.createElement("p");h.appendChild(document.createTextNode("(Optional) Paste previously generated frame data (for one element) into textarea below and "));var v=document.createElement("button");v.setAttribute("type","button"),v.setAttribute("onclick","window.tfFrames.loadFrames();"),v.setAttribute("tabindex",e++),v.appendChild(document.createTextNode("Load")),this.loadBtn=v,h.appendChild(v),h.appendChild(document.createTextNode(" OR select "));var b=document.createElement("select");b.setAttribute("name","frame"),b.setAttribute("tabindex",e++),this.selectAni=b,h.appendChild(b);var f=document.createElement("button");f.setAttribute("type","button"),f.setAttribute("id","reEditBtn"),f.setAttribute("onclick","window.tfFrames.reEdit();"),f.setAttribute("disabled",""),f.setAttribute("tabindex",e++),f.appendChild(document.createTextNode("Re-Edit")),this.reEditBtn=f,h.appendChild(f),p.appendChild(h);var A=document.createElement("li");u.appendChild(A);var g=document.createElement("p"),y=document.createElement("label");y.appendChild(document.createTextNode("If frames not loaded in step 1, generate: ")),g.appendChild(y);var C=document.createElement("input");C.setAttribute("type","number"),C.setAttribute("name","genFrames"),C.setAttribute("value","50"),C.setAttribute("id","frameCount"),C.setAttribute("tabindex",e++),this.frameCount=C,g.appendChild(C),g.appendChild(document.createTextNode(" frames with class "));var E=document.createElement("input");E.setAttribute("type","text"),E.setAttribute("value",""),E.setAttribute("id","frameClass"),E.setAttribute("tabindex",e++),this.frameClass=E,g.appendChild(E);var N=document.createElement("input");N.setAttribute("type","text"),N.setAttribute("value",""),N.setAttribute("id","frameName"),this.frameName=N;var x=document.createElement("button");x.setAttribute("type","button"),x.setAttribute("onclick","window.tfFrames.generateFrames();"),x.setAttribute("tabindex",e++),x.appendChild(document.createTextNode("Go >")),this.goBtn=x,g.appendChild(x),A.appendChild(g);var F=document.createElement("li");u.appendChild(F);var T=document.createElement("p");T.appendChild(document.createTextNode("Select "));var w=document.createElement("select");w.setAttribute("name","frame"),w.setAttribute("onchange","window.tfFrames.changeSelectFrame();"),w.setAttribute("tabindex",e++),this.selectFrame=w,T.appendChild(w),T.appendChild(document.createTextNode(" frame and set style to "));var B=document.createElement("input");B.setAttribute("type","text"),B.setAttribute("value",""),B.setAttribute("id","frameStyle"),B.setAttribute("style","width:500px;"),B.setAttribute("onkeyup","window.tfFrames.setFrameStyle();"),B.setAttribute("tabindex",e++),this.frameStyle=B,T.appendChild(B),T.appendChild(document.createTextNode(" with exposure count of "));var k=document.createElement("input");k.setAttribute("type","number"),k.setAttribute("value","1"),k.setAttribute("id","frameExposureCount"),k.setAttribute("onblur","window.tfFrames.setFrameExposureCount();"),k.setAttribute("tabindex",e++),this.exposureCount=k,T.appendChild(k),F.appendChild(T);var D=(document.createElement("li"),document.createElement("p"));D.appendChild(document.createTextNode("Use "));var S=document.createElement("input");S.setAttribute("type","text"),S.setAttribute("value",""),S.setAttribute("id","frameName2"),this.frameName2=S,D.appendChild(S),D.appendChild(document.createTextNode(" frames and "));var H=document.createElement("button");H.setAttribute("type","button"),H.setAttribute("onclick","window.tfFrames.generateKeyframes();"),H.appendChild(document.createTextNode("Generate Keyframes >")),this.genBtn=H,D.appendChild(H);for(var L=["Press test button to see results","Re-edit until happy.","After final test click Keep button (which empties the form to allow work on another element).","Repeat steps above until finished.","Once all happy click Get HTML button to put html in the box below (remember to include you own stylesheet).","Use the View Data button to view frame data."],M=0;M<L.length;M++){var I=document.createElement("li");u.appendChild(I);var _=document.createElement("p");_.appendChild(document.createTextNode(L[M])),I.appendChild(_)}l.appendChild(u),t.appendChild(l);var q=document.createElement("textarea");q.setAttribute("rows","10"),q.setAttribute("cols","100"),q.setAttribute("id","css"),q.setAttribute("tabindex",e++),this.output=q,l.appendChild(q);var R=document.createElement("div");R.setAttribute("id","stage"),this.stageDiv=R;var O=document.createElement("div");O.setAttribute("class","frames"),this.framesDiv=O,R.appendChild(O),t.appendChild(R),this.toggle()}};